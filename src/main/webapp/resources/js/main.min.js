var addressBook=angular.module("AddressBook",["ngRoute","ContactServices"]);addressBook.config(["$routeProvider",function(a){a.when("/contacts",{templateUrl:"resources/partials/allContacts.html",controller:"AllContactsController"}).when("/contact/add",{templateUrl:"resources/partials/contact.html",controller:"AddEditContactController"}).when("/contact/:id",{templateUrl:"resources/partials/viewContact.html",controller:"GetContactController"}).when("/contact/edit/:id",{templateUrl:"resources/partials/contact.html",controller:"AddEditContactController"}).otherwise({redirectTo:"/contacts"})}]),addressBook.controller("AllContactsController",["$scope","$location","$routeParams","Contact",function(a,b,c,d){a.loading=!0,a.message="Please wait while contacts are being loaded...";var e=d.query({},function(){a.contacts=e,a.loading=!1},function(){a.message="Oops something went wrong!"});a.addContact=function(){b.path("/contact/add")},a.getContact=function(a){b.path("/contact/"+a)}}]),addressBook.controller("AddEditContactController",["$scope","$location","$rootScope","$routeParams","Contact","Store","GenericFunctions",function(a,b,c,d,e,f,g){a.error=!1,a.edit=!1;var h;b.path().indexOf("edit")>-1&&(a.edit=!0,h=f.getContact(),null!==h?a.contact=g.convertToDisplay(h):b.path("/contact/"+d.id)),a.submit=function(){a.error=!1,h=g.convertToSend(a.contact,h),a.contact.contactId?e.update(h,function(){c.success=!0,c.message="Contact updated successfully!",b.path("/contact/"+a.contact.contactId)},function(){a.error=!0}):e.save(h,function(a){c.success=!0,c.message="Contact saved successfully!",b.path("/contact/"+a.contactId)},function(){a.error=!0})},a.cancel=function(){b.path("/contacts")}}]),addressBook.controller("GetContactController",["$scope","$location","$routeParams","$rootScope","Contact","Store","GenericFunctions",function(a,b,c,d,e,f,g){a.back=function(){b.path("/contacts")},a.edit=function(){b.path("/contact/edit/"+a.contact.contactId)};var h=e.get({id:c.id},function(){a.contact=g.convertToDisplay(h),f.saveContact(h)});a.$on("$destroy",function(){d.success=!1,d.message=""})}]),addressBook.directive("appHeader",function(){return{restrict:"AE",template:"<h2>My Address Book</h2>"}});var contactServices=angular.module("ContactServices",["ngResource"]);contactServices.factory("Contact",["$resource",function(a){return a("api/contacts/:id",{contactId:"@id"},{get:{method:"GET",isArray:!1},query:{method:"GET",isArray:!0},update:{method:"PUT"}})}]),contactServices.service("Store",function(){var a,b=function(b){a=b},c=function(){return a};return{saveContact:b,getContact:c}}),contactServices.service("GenericFunctions",function(){var a=function(a,b){if(null===b&&(b={}),b.id=a.contactId,b.lastName=a.lastName,b.firstName=a.firstName,null!==a.phone&&null!==a.phone.number)if(null!==b.phones&&b.phones.length>0)for(var c=0;c<b.phones.length;c++)b.phones[c].primaryPhone===!0&&(b.phones[c].number=a.phone.number);else{var d={};d.number=a.phone.number,d.type="Cell",d.primaryPhone=!0,b.phones=[],b.phones.push(d)}if(null!==a.email&&(console.log(1),null!==a.email.address))if(console.log(2),null!==b.emails&&b.emails.length>0){console.log(3);for(var e=0;e<b.emails.length;e++)b.emails[e].primaryEmail===!0&&(b.emails[e].address=a.email.address)}else{console.log(5);var f={};f.address=a.email.address,f.primaryEmail=!0,b.emails=[],b.emails.push(f),console.log(6)}b.address;return null!==a.address&&(null===b.address&&(b.address={}),b.address.address1=a.address.address1,b.address.address2=a.address.address2,b.address.city=a.address.city,b.address.state=a.address.state,b.address.country=a.address.country,b.address.zip=a.address.zip),b},b=function(a){contact={},contact.contactId=a.id,contact.lastName=a.lastName,contact.firstName=a.firstName,contact.fullName=contact.firstName+" "+contact.lastName;var b=a.phones;if(null!==b)for(var c=0;c<b.length;c++)b[c].primaryPhone===!0&&(contact.phone={},contact.phone.id=b[c].id,contact.phone.number=b[c].number);var d=a.emails;if(null!==d)for(var e=0;e<d.length;e++)d[e].primaryEmail===!0&&(contact.email={}),contact.email.id=d[e].id,contact.email.address=d[e].address;if(null!==a.address){contact.address={};var f=a.address;contact.address.address1=f.address1,contact.address.address2=f.address2,contact.address.city=f.city,contact.address.zip=f.zip,contact.address.state=f.state,contact.address.country=f.country,null!==contact.address.city&&(contact.address.address3=contact.address.city),null!==contact.address.state&&""!==contact.address.state&&(null!==contact.address.city?(contact.address.address3+=", ",contact.address.address3+=contact.address.state):contact.address.address3=contact.address.state),null!==contact.address.country&&(contact.address.address4=contact.address.country),null!==contact.address.zip&&""!==contact.address.zip&&(null!==contact.address.country?(contact.address.address4+=", ",contact.address.address4+=contact.address.zip):contact.address.address4=contact.address.zip)}return contact};return{convertToDisplay:b,convertToSend:a}});